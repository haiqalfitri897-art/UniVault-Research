#!/bin/bash

# Railway Deployment Helper - UniVault Research Backend
# This script provides instructions for deploying to Railway

echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
echo "â•‘     Railway Deployment Helper - UniVault Backend               â•‘"
echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
echo ""

# Colors
GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
NC='\033[0m'

echo -e "${BLUE}ğŸ“‹ Deployment Checklist${NC}"
echo ""
echo "Before deploying to Railway, ensure:"
echo ""
echo "1. Prerequisites:"
echo "   â˜ GitHub account created"
echo "   â˜ Code committed to GitHub"
echo "   â˜ Railway account created (https://railway.app)"
echo ""
echo "2. Environment Variables Ready:"
echo "   â˜ NODE_ENV: production"
echo "   â˜ JWT_SECRET: strong random string (64+ chars)"
echo "   â˜ FRONTEND_URL: your frontend URL"
echo "   â˜ PORT: 5000"
echo ""
echo "3. Code Ready:"
echo "   â˜ backend/package.json exists"
echo "   â˜ backend/Dockerfile exists"
echo "   â˜ backend/src/server.js exists"
echo "   â˜ All code committed to git"
echo ""

echo -e "${BLUE}ğŸš€ Deployment Steps${NC}"
echo ""
echo "1. Go to https://railway.app"
echo "2. Log in with your GitHub account"
echo "3. Create new project"
echo "4. Select 'Deploy from GitHub'"
echo "5. Authorize Railway to access your repos"
echo "6. Select 'UniVault-Research' repository"
echo "7. Railway auto-detects backend/Dockerfile"
echo ""

echo -e "${BLUE}âš™ï¸  Environment Variables to Set${NC}"
echo ""
echo "In Railway dashboard, go to Variables and add:"
echo ""
echo "NAME: NODE_ENV"
echo "VALUE: production"
echo ""
echo "NAME: JWT_SECRET"
echo "VALUE: [Run: node -e \"console.log(require('crypto').randomBytes(32).toString('hex'))\"]"
echo ""
echo "NAME: FRONTEND_URL"
echo "VALUE: https://your-frontend-url.vercel.app"
echo "       (Update after deploying frontend)"
echo ""
echo "NAME: PORT"
echo "VALUE: 5000"
echo ""

echo -e "${BLUE}ğŸ”‘ Generate JWT_SECRET${NC}"
echo ""
echo "Run this command to generate a secure random string:"
echo ""
echo "  node -e \"console.log(require('crypto').randomBytes(32).toString('hex'))\""
echo ""
echo "Copy the output and use as JWT_SECRET in Railway"
echo ""

echo -e "${BLUE}âœ… After Deployment${NC}"
echo ""
echo "1. Check Deployments tab for 'Active' status"
echo "2. Review Logs - should see:"
echo "   'ğŸš€ Server is running on http://localhost:5000'"
echo "3. Copy Public URL from Railway dashboard"
echo "4. Test health endpoint:"
echo "   curl https://your-railway-url/api/health"
echo "5. Save URL for frontend configuration"
echo ""

echo -e "${BLUE}ğŸ”— Public URL Format${NC}"
echo ""
echo "Your backend will be accessible at:"
echo "https://your-service-name.railway.app/api"
echo ""
echo "Example endpoints:"
echo "  POST   https://your-service-name.railway.app/api/auth/register"
echo "  POST   https://your-service-name.railway.app/api/auth/login"
echo "  GET    https://your-service-name.railway.app/api/health"
echo ""

echo -e "${BLUE}ğŸ“Š Verify Deployment${NC}"
echo ""
echo "Test your backend is running:"
echo ""
echo "# Health check"
echo "curl https://your-railway-url/api/health"
echo ""
echo "# Register user"
echo "curl -X POST https://your-railway-url/api/auth/register \\"
echo "  -H 'Content-Type: application/json' \\"
echo "  -d '{\"name\":\"Test\",\"email\":\"test@test.com\",\"password\":\"test123\"}'"
echo ""

echo -e "${BLUE}ğŸ†˜ Troubleshooting${NC}"
echo ""
echo "Issue: Build failed"
echo "  â†’ Check build logs in Railway Deployments tab"
echo "  â†’ Ensure package.json syntax is correct"
echo "  â†’ Verify Node version (18+ required)"
echo ""
echo "Issue: Server won't start"
echo "  â†’ Check JWT_SECRET is set"
echo "  â†’ Verify NODE_ENV=production"
echo "  â†’ Check logs for specific error"
echo ""
echo "Issue: Can't connect from frontend"
echo "  â†’ Update FRONTEND_URL in Railway"
echo "  â†’ Update frontend VITE_API_URL to Railway URL"
echo "  â†’ Check CORS is working"
echo ""
echo "Issue: CORS error in browser"
echo "  â†’ Ensure FRONTEND_URL matches frontend domain"
echo "  â†’ Backend already has CORS configured"
echo "  â†’ Restart service after variable changes"
echo ""

echo -e "${BLUE}ğŸ“š Documentation${NC}"
echo ""
echo "For detailed information:"
echo "  â€¢ RAILWAY_DEPLOYMENT.md    - Full Railway guide"
echo "  â€¢ QUICK_DEPLOY.md          - Quick start guide"
echo "  â€¢ DEPLOYMENT.md            - All deployment options"
echo "  â€¢ API.md                   - API endpoints reference"
echo ""

echo -e "${GREEN}âœ¨ You're ready to deploy!${NC}"
echo ""
echo "Next: Visit https://railway.app and follow the deployment steps above"
echo ""
